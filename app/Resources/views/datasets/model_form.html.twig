{% extends 'default_bootstrap_admin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" rel="stylesheet" type="text/css">
    {% if data.model_repository_id is defined %}
        <link href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="https://cdn.datatables.net/buttons/1.5.1/css/buttons.bootstrap.min.css" rel="stylesheet" type="text/css" />
    {% endif %}
{% endblock %}

{% block content %}
    <div class="alert alert-warning" role="alert">
        TODO: Provide a way to reference existing UV Maps?
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <div class="form-group">
                <a href="{{ back_link }}" class="btn btn-default" role="button"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Back</a>
            </div>
        </div>
    </div>

    {{ form_start(form) }} {# , {'attr': {'novalidate': 'novalidate'}} #}

    <div class="row">
        <div class="col-sm-6 col-md-6">
            {{ form_row(form.model_guid) }}
            {{ form_row(form.date_of_creation) }}
            {{ form_row(form.model_file_type) }}
            {{ form_row(form.derived_from) }}
            {{ form_row(form.creation_method) }}
            {{ form_row(form.model_modality) }}
            {{ form_row(form.units) }}
            {{ form_row(form.is_watertight) }}
        </div>
        <div class="col-sm-6 col-md-6">
            {{ form_row(form.model_purpose) }}
            {{ form_row(form.point_count) }}
            {{ form_row(form.has_normals) }}
            {{ form_row(form.face_count) }}
            {{ form_row(form.vertices_count) }}
            {{ form_row(form.has_vertex_color) }}
            {{ form_row(form.has_uv_space) }}
            {{ form_row(form.model_maps) }}
        </div>
    </div>

    <div class="field-group" style="clear:both;">
        {{ form_row(form.save) }}
    </div>

    {{ form_end(form) }}

    {% if data.model_repository_id is defined %}
        <div class="row">
            <div class="col-sm-12 col-md-12 child-data">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <h2>Processing Actions</h2>
                        <div class="alert alert-warning" role="alert">
                            TODO: Add the button to add Processing Action records
                        </div>
                        <table id="browse_processing_actions" class="table table-striped table-bordered" cellspacing="0" width="100%">
                            <thead>
                            <tr>
                                <th style="padding-left: 8px;"><input id="remove-records-checkbox" type="checkbox"> Remove?</th>
                                <th class="text-center">Preceding Processing Action Repository ID</th>
                                <th class="text-center">Date of Action</th>
                                <th class="text-center">Action Method</th>
                                <th class="text-center">Software Used</th>
                                <th class="text-center">Action Description</th>
                                <th class="text-center">Last Modified</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript">
      // Datepicker
      $(document).ready(function(){
        var date_of_creation_input = $('input[name="model_form[date_of_creation]"]');
        var container = $('form.model_form').length > 0 ? $('form.model_form').parent() : 'body';
        var options = {
          format: 'yyyy-mm-dd 00:00:00',
          container: container,
          todayHighlight: true,
          autoclose: true,
        };
        date_of_creation_input.datepicker(options);
      });
    </script>

    {% if data.model_repository_id is defined %}
        <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.colVis.min.js"></script>
        <script type="text/javascript">
          $(document).ready(function() {
            var parent_id = "{{ data.model_repository_id }}";
            $('#browse_processing_actions').dataTable( {
              "columns": [
                { "data": "manage" },
                { "data": "preceding_processing_action_repository_id" },
                { "data": "date_of_action" },
                { "data": "action_method" },
                { "data": "software_used" },
                { "data": "action_description" },
                { "data": "last_modified" }
              ],
              "dom": 'lfip<"datatables_bulk_actions">tip',
              "pagingType": "simple_numbers",
              "stateSave": true,
              "order": [[6,"desc"]],
              // Show processing throbber.
              "processing": true,
              "serverMethod": "POST",
              // All data management will be done on the server side.
              "serverSide": true,
              // Path to the file that is going to handle the queries.
              "ajax": {
                "url": "/admin/projects/processing_action/datatables_browse",
                "data": {
                  "parent_id": parent_id
                }
              },
              // Method type.
              "serverMethod": "POST",
              // Values in the length dropdown.
              "lengthMenu":[10,50,100,500],
              // Set some widths.
              "aoColumnDefs":[
                {"sWidth":"106px","aTargets":[0]},
                {"bSortable":false,"aTargets":[0]},
              ],
              "fnRowCallback":function(nRow, aData, iDisplayIndex) {

                // This table row.
                var thisTableRow = $(nRow);
                // Create the delete record checkboxes.
                thisTableRow.find('td:eq(0)')
                  .html("<input type='checkbox' name='manage_checkbox' value='" + aData['manage'] + "' />")
                  .addClass("manage_column");
                // Send to details page when clicked.
                thisTableRow.find('td').click(function() {
                  // This table cell.
                  var thisTableCell = $(this);
                  // Don't do anything if the table cell has the 'manage_column' CSS class.
                  if(thisTableCell.hasClass('manage_column')) return;
                  // Send to the details page.
                  var this_id = thisTableCell.closest("tr").attr('id');
                  window.location.href = '/admin/projects/processing_action/manage/' + parent_id + '/' + this_id;
                });
              }
            });

            var add_button = $('<a />')
              .addClass('btn btn-default add-record-button')
              .attr('href', '/admin/projects/processing_action/manage/' + parent_id)
              .html('<span class="glyphicon glyphicon-plus"></span> Add a Processing Action');

            $('#browse_processing_actions_wrapper').find('.datatables_bulk_actions').append(add_button);

          });
        </script>
    {% endif %}
{% endblock %}